@inject IGameService GameService

<div class="m-2 p-3 border rounded-3 border-dark-subtle">
    @if (newGame.CreatingGame)
    {
        <LoadingSpinner />
    }
    else
    {
        <div><span class="fw-bold pe-1">@GameName</span>æš‚æ—¶æœªè¢«æ”¶å½•ï¼Œä¸è€ƒè™‘æˆä¸ºåˆ›å»ºè€…ğŸ</div>
        <div class="form-check form-switch mt-1">
            <input class="form-check-input" id="createGameSwitch" type="checkbox" role="switch"
                @bind="_createGame" @oninput="OnCreateGameSwitchAsync">
            <label class="form-check-label" for="createGameSwitch">æ–°å»ºæ¸¸æˆï¼Ÿ</label>
        </div>
        @if (_createGame)
        {
            <hr>
            <div class="d-flex align-items-stretch gap-3 mt-2">
                <label class="form-label text-nowrap my-auto" for="IconUpload">ç»™<span class="fw-bold px-1">@GameName</span>ä¸Šä¼ ä¸€ä¸ªå›¾æ ‡å§</label>
                <InputFile class="form-control" id="IconUpload" accept="image/jpg, image/png, image/jpeg" />
            </div>
            <div class="d-flex justify-content-end align-items-stretch gap-3 mt-3">
                <div class="form-check my-auto">
                    <input class="form-check-input" id="followCheck" type="checkbox" @bind="newGame.Follow">
                    <label class="form-check-label" for="followCheck">æˆä¸ºç¬¬1ä¸ªå…³æ³¨è€…</label>
                </div>
                <button class="btn btn-primary" type="button" @onclick="OnNewGameCreateAsync">åˆ›å»ºâ­æ¸¸æˆ</button>
            </div>
        }
    }
</div>

@code {
    [Parameter, EditorRequired]
    public string GameName { get; set; } = string.Empty;
    [Parameter]
    public bool CreateNewGame { get; set; } = true;
    [Parameter]
    public EventCallback<bool> CreateNewGameChanged { get; set; }
    [Parameter]
    public bool ExistedGame {get;set;} = false;
    [Parameter]
    public EventCallback<bool> ExistedGameChanged { get; set; }

    private bool _createGame = false;

    private GameModel newGame = default!;

    protected override void OnInitialized()
    {
        base.OnInitialized();

        newGame = new GameModel(GameName);
        _createGame = CreateNewGame;
    }

    private async void OnCreateGameSwitchAsync()
    {
        await CreateNewGameChanged.InvokeAsync(_createGame);
    }

    private void OnIconFileUploaded()
    {
        // TODO: Handle image upload and rename file and get the uri
    }

    private async void OnNewGameCreateAsync()
    {
        newGame.CreatingGame = true;

        // TODO: Create the game

        await Task.Delay(3000);

        bool existedNewGame = await GameService.HasGameNameAsync(newGame.GameName);
        await ExistedGameChanged.InvokeAsync(existedNewGame);

        newGame.CreatingGame = false;
        StateHasChanged();
    }
}